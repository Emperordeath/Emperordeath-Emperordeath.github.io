<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Login & Cadastro & Dashboard</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #1f4037, #99f2c8);
    height: 100vh;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .container {
    background: white;
    padding: 2rem 3rem;
    border-radius: 10px;
    box-shadow: 0 8px 15px rgba(0,0,0,0.1);
    width: 340px;
    text-align: center;
  }
  .tabs {
    display: flex;
    margin-bottom: 1.5rem;
    cursor: pointer;
    user-select: none;
    border-bottom: 2px solid #1f4037;
  }
  .tab {
    flex: 1;
    padding: 0.5rem 0;
    color: #1f4037;
    font-weight: 600;
    border-bottom: 3px solid transparent;
    transition: border-color 0.3s;
  }
  .tab.active {
    border-color: #1f4037;
  }
  input[type="email"],
  input[type="password"] {
    width: 100%;
    padding: 0.8rem;
    margin-bottom: 1rem;
    border: 1.5px solid #1f4037;
    border-radius: 6px;
    font-size: 1rem;
  }
  button {
    background-color: #1f4037;
    color: white;
    border: none;
    padding: 0.9rem;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    width: 100%;
    transition: background-color 0.3s ease;
    margin-top: 0.5rem;
  }
  button:hover {
    background-color: #163225;
  }
  .msg {
    margin-top: 1rem;
    font-size: 0.9rem;
    color: red;
    min-height: 1.3em;
  }
  /* Dashboard */
  #dashboard {
    display: none;
  }
  #dashboard h2 {
    margin-bottom: 1rem;
  }
  #btn-logout {
    background-color: #b22222;
  }
  #btn-logout:hover {
    background-color: #7f1a1a;
  }
</style>
</head>
<body>

<div class="container">

  <!-- Tabs (Login / Cadastro) -->
  <div id="tabs" class="tabs">
    <div id="tab-login" class="tab active">Entrar</div>
    <div id="tab-register" class="tab">Cadastrar</div>
  </div>

  <!-- Login form -->
  <form id="form-login">
    <input id="login-email" type="email" placeholder="Email" required />
    <input id="login-password" type="password" placeholder="Senha" required />
    <button type="submit">Entrar</button>
  </form>

  <!-- Register form -->
  <form id="form-register" style="display:none;">
    <input id="register-email" type="email" placeholder="Email" required />
    <input id="register-password" type="password" placeholder="Senha" required />
    <input id="register-password2" type="password" placeholder="Confirme a Senha" required />
    <button type="submit">Cadastrar</button>
  </form>

  <!-- Dashboard -->
  <div id="dashboard">
    <h2>Bem vindo, <span id="user-email"></span>!</h2>
    <button id="btn-logout">Sair</button>
  </div>

  <div class="msg" id="msg"></div>

</div>

<script>
  const tabLogin = document.getElementById('tab-login');
  const tabRegister = document.getElementById('tab-register');
  const formLogin = document.getElementById('form-login');
  const formRegister = document.getElementById('form-register');
  const dashboard = document.getElementById('dashboard');
  const userEmailSpan = document.getElementById('user-email');
  const msg = document.getElementById('msg');
  const btnLogout = document.getElementById('btn-logout');
  const tabs = document.getElementById('tabs');

  function showLogin() {
    tabs.style.display = 'flex';
    formLogin.style.display = 'block';
    formRegister.style.display = 'none';
    dashboard.style.display = 'none';
    msg.textContent = '';
    tabLogin.classList.add('active');
    tabRegister.classList.remove('active');
  }

  function showRegister() {
    tabs.style.display = 'flex';
    formLogin.style.display = 'none';
    formRegister.style.display = 'block';
    dashboard.style.display = 'none';
    msg.textContent = '';
    tabRegister.classList.add('active');
    tabLogin.classList.remove('active');
  }

  function showDashboard(email) {
    tabs.style.display = 'none';
    formLogin.style.display = 'none';
    formRegister.style.display = 'none';
    dashboard.style.display = 'block';
    userEmailSpan.textContent = email;
    msg.textContent = '';
  }

  tabLogin.onclick = showLogin;
  tabRegister.onclick = showRegister;

  // Checa token e mostra dashboard direto se existir
  window.onload = () => {
    const token = localStorage.getItem('token');
    if (!token) {
      showLogin();
      return;
    }

    // Valida token com backend (exemplo simples)
    fetch('http://localhost:3000/api/dashboard', {
      headers: { 'Authorization': 'Bearer ' + token }
    })
    .then(res => {
      if (!res.ok) throw new Error('Token inválido');
      return res.json();
    })
    .then(data => {
      showDashboard(data.message.replace('Bem vindo, ', '').replace('!', ''));
    })
    .catch(() => {
      localStorage.removeItem('token');
      showLogin();
    });
  };

  formLogin.addEventListener('submit', async e => {
    e.preventDefault();
    msg.style.color = 'red';

    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value.trim();

    if (!email || !password) {
      msg.textContent = 'Preencha todos os campos, mano.';
      return;
    }

    try {
      const res = await fetch('http://localhost:3000/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password }),
      });
      const data = await res.json();

      if (res.ok) {
        msg.style.color = 'green';
        msg.textContent = 'Login OK! Entrando...';
        localStorage.setItem('token', data.token);
        showDashboard(email);
      } else {
        msg.textContent = data.message || 'Falha no login.';
      }
    } catch {
      msg.textContent = 'Erro de conexão, tenta de novo.';
    }
  });

  formRegister.addEventListener('submit', async e => {
    e.preventDefault();
    msg.style.color = 'red';

    const email = document.getElementById('register-email').value.trim();
    const password = document.getElementById('register-password').value.trim();
    const password2 = document.getElementById('register-password2').value.trim();

    if (!email || !password || !password2) {
      msg.textContent = 'Preencha todos os campos, parceiro.';
      return;
    }

    if (password !== password2) {
      msg.textContent = 'As senhas não batem, confere aí.';
      return;
    }

    try {
      const res = await fetch('http://localhost:3000/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password }),
      });
      const data = await res.json();

      if (res.ok) {
        msg.style.color = 'green';
        msg.textContent = 'Cadastro feito! Já pode entrar.';
        showLogin();
      } else {
        msg.textContent = data.message || 'Falha no cadastro.';
      }
    } catch {
      msg.textContent = 'Erro de conexão, tenta de novo.';
    }
  });

  btnLogout.onclick = () => {
    localStorage.removeItem('token');
    showLogin();
  };
</script>

</body>
</html>
